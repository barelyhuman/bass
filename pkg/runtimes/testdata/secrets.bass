(def *memos* *dir*/bass.lock)

(def stdin-secret
  (from (linux/alpine)
    (.cat (mask "stdin hunter2" :stdin-secret))))

(def env-secret
  (from (linux/alpine)
    (-> ($ sh -c "echo $SECRET")
        (with-env {:SECRET (mask "env hunter2" :env-secret)}))))

(def file-secret
  (from (linux/alpine)
    (-> ($ cat /tmp/secret)
        (with-mount (mask "mount hunter2" :mount-secret) /tmp/secret))))

(def results
  [(-> stdin-secret (read :json) next)
   (-> env-secret (read :lines) next)
   (-> file-secret (read :lines) next)])

(assert-does-not-contain-secret (*display*))

(map assert-export-does-not-contain-secret
     [stdin-secret env-secret file-secret])

results
