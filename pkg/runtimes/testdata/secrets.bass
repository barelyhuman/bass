(def *memos* *dir*/bass.lock)

(def bruce-banner
  (mask *secret* :bruce-banner))

(def arg-secret
  (from (linux/alpine)
    ($ sh -c "echo $0" $bruce-banner)))

(def stdin-secret
  (from (linux/alpine)
    (.cat bruce-banner)))

(def env-secret
  (from (linux/alpine)
    (-> ($ sh -c "echo $SECRET")
        (with-env {:SECRET bruce-banner}))))

(def file-secret
  (from (linux/alpine)
    (-> ($ cat /tmp/secret)
        (with-mount bruce-banner /tmp/secret))))

(map assert-export-does-not-contain-secret
     [(-> stdin-secret (read :json) next)
      (-> env-secret (read :lines) next)
      (-> arg-secret (read :lines) next)
      (-> file-secret (read :lines) next)])

(assert-does-not-contain-secret (*display*))
